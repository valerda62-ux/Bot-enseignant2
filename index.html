<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bot Enseignant Automatique - Fran√ßais Malagasy</title>
<style>
    :root {
        --primary: #2563eb;
        --primary-dark: #1d4ed8;
        --secondary: #059669;
        --secondary-dark: #047857;
        --accent: #dc2626;
        --accent-dark: #b91c1c;
        --light: #f8fafc;
        --dark: #1e293b;
        --gray: #64748b;
        --light-gray: #f1f5f9;
        --border: #e2e8f0;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    
    body {
        font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
        color: var(--dark);
        line-height: 1.6;
        font-weight: 400;
    }
    
    .bot-container {
        background: #ffffff;
        padding: 32px;
        border-radius: 16px;
        box-shadow: var(--shadow-lg);
        max-width: 1000px;
        width: 100%;
        position: relative;
        overflow: hidden;
    }
    
    .bot-header {
        text-align: center;
        margin-bottom: 32px;
        position: relative;
    }
    
    .bot-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        margin: 0 auto 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 32px;
        box-shadow: var(--shadow);
        border: 4px solid white;
    }
    
    .bot-header h2 {
        color: var(--dark);
        margin-bottom: 8px;
        font-size: 28px;
        font-weight: 700;
        letter-spacing: -0.025em;
    }
    
    .bot-subtitle {
        color: var(--gray);
        font-size: 16px;
        margin-bottom: 24px;
        font-weight: 500;
    }
    
    .progress-container {
        margin: 24px 0;
        background: var(--light-gray);
        border-radius: 12px;
        height: 8px;
        overflow: hidden;
        position: relative;
    }
    
    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--primary), var(--primary-dark));
        border-radius: 12px;
        width: 0%;
        transition: width 0.5s ease;
        position: relative;
    }
    
    .progress-text {
        text-align: center;
        font-size: 14px;
        color: var(--gray);
        margin-top: 12px;
        font-weight: 500;
    }
    
    .navigation-buttons {
        display: flex;
        justify-content: space-between;
        margin-bottom: 24px;
        flex-wrap: wrap;
        gap: 12px;
    }
    
    .content-area {
        min-height: 500px;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 28px;
        margin-bottom: 24px;
        background: var(--light);
        transition: all 0.3s ease;
    }
    
    .typing-indicator {
        display: none;
        text-align: center;
        padding: 24px;
        color: var(--gray);
        font-style: italic;
        background: white;
        border-radius: 12px;
        margin: 20px 0;
        box-shadow: var(--shadow);
    }
    
    .typing-dots {
        display: inline-block;
        margin-left: 8px;
    }
    
    .typing-dots span {
        animation: typing 1.5s infinite;
        display: inline-block;
    }
    
    .typing-dots span:nth-child(2) {
        animation-delay: 0.2s;
    }
    
    .typing-dots span:nth-child(3) {
        animation-delay: 0.4s;
    }
    
    @keyframes typing {
        0%, 100% { opacity: 0.2; }
        50% { opacity: 1; }
    }
    
    .lesson-section, .exercise-section, .oral-practice-section {
        display: none;
    }
    
    .lesson-content {
        background: white;
        padding: 28px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        margin-bottom: 24px;
        border-left: 4px solid var(--primary);
    }
    
    .lesson-title {
        color: var(--dark);
        font-weight: 700;
        margin-bottom: 20px;
        font-size: 22px;
        padding-bottom: 16px;
        border-bottom: 2px solid var(--light-gray);
        letter-spacing: -0.025em;
    }
    
    .lesson-desc {
        line-height: 1.7;
        margin-bottom: 24px;
        color: var(--dark);
        font-size: 16px;
        background: var(--light-gray);
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid var(--primary);
    }
    
    .language-tabs {
        display: flex;
        margin-bottom: 24px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: var(--shadow);
    }
    
    .language-tab {
        padding: 16px 24px;
        cursor: pointer;
        background: var(--light-gray);
        transition: all 0.3s ease;
        flex: 1;
        text-align: center;
        font-weight: 600;
        color: var(--gray);
        border: none;
        font-size: 15px;
    }
    
    .language-tab.active {
        background: var(--primary);
        color: white;
        font-weight: 600;
    }
    
    .language-tab:hover:not(.active) {
        background: #e2e8f0;
    }
    
    .language-content {
        display: none;
        background: white;
        padding: 24px;
        border-radius: 0 0 8px 8px;
        line-height: 1.7;
    }
    
    .language-content.active {
        display: block;
    }
    
    .language-content h4 {
        color: var(--dark);
        margin: 24px 0 16px 0;
        font-weight: 700;
        font-size: 18px;
        letter-spacing: -0.025em;
    }
    
    .language-content h5 {
        color: var(--dark);
        margin: 20px 0 12px 0;
        font-weight: 600;
        font-size: 16px;
    }
    
    .language-content p {
        margin-bottom: 16px;
        color: var(--dark);
        font-size: 16px;
    }
    
    .language-content strong {
        color: var(--primary);
        font-weight: 600;
    }
    
    .language-content ul {
        margin: 16px 0 20px 24px;
    }
    
    .language-content li {
        margin-bottom: 12px;
        position: relative;
        padding-left: 8px;
    }
    
    .language-content li:before {
        content: "‚Ä¢";
        color: var(--primary);
        font-weight: bold;
        margin-right: 12px;
    }
    
    .lesson-image {
        text-align: center;
        font-size: 56px;
        margin: 28px 0;
        padding: 24px;
        background: white;
        border-radius: 12px;
        box-shadow: var(--shadow);
    }
    
    .exercise-content {
        background: white;
        padding: 28px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        border-left: 4px solid var(--secondary);
    }
    
    .exercise-question {
        font-size: 18px;
        margin-bottom: 24px;
        font-weight: 600;
        color: var(--dark);
        line-height: 1.6;
    }
    
    .exercise-counter {
        font-size: 14px;
        color: var(--gray);
        margin-bottom: 20px;
        text-align: center;
        background: var(--light-gray);
        padding: 12px;
        border-radius: 8px;
        font-weight: 500;
    }
    
    .input-group {
        margin-bottom: 24px;
        position: relative;
    }
    
    input[type="text"] {
        width: 100%;
        padding: 16px 60px 16px 20px;
        font-size: 16px;
        border-radius: 8px;
        border: 2px solid var(--border);
        transition: all 0.3s;
        background: white;
        font-family: inherit;
        font-weight: 500;
    }
    
    input[type="text"]:focus {
        border-color: var(--primary);
        outline: none;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    .voice-input-btn {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: var(--light-gray);
        border: none;
        border-radius: 8px;
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s;
        color: var(--gray);
        font-size: 18px;
    }
    
    .voice-input-btn:hover {
        background: var(--primary);
        color: white;
        transform: translateY(-50%) scale(1.05);
    }
    
    .voice-input-btn.recording {
        background: var(--accent);
        color: white;
        animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
        0% { transform: translateY(-50%) scale(1); }
        50% { transform: translateY(-50%) scale(1.1); }
        100% { transform: translateY(-50%) scale(1); }
    }
    
    .button-container {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-top: 24px;
    }
    
    button {
        padding: 16px 24px;
        font-size: 15px;
        border: none;
        border-radius: 8px;
        background: var(--primary);
        color: white;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-weight: 600;
        flex: 1;
        min-width: 160px;
        letter-spacing: -0.025em;
    }
    
    button:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: var(--shadow);
    }
    
    button:active {
        transform: translateY(0);
    }
    
    button.secondary {
        background: var(--secondary);
    }
    
    button.secondary:hover {
        background: var(--secondary-dark);
    }
    
    button.accent {
        background: var(--accent);
    }
    
    button.accent:hover {
        background: var(--accent-dark);
    }
    
    button.outline {
        background: transparent;
        border: 2px solid var(--primary);
        color: var(--primary);
    }
    
    button.outline:hover {
        background: var(--primary);
        color: white;
    }
    
    .message {
        margin: 24px 0;
        font-size: 16px;
        font-weight: 600;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        border-left: 4px solid transparent;
        box-shadow: var(--shadow);
    }
    
    .success {
        background: #f0fdf4;
        color: #166534;
        border-left-color: var(--secondary);
    }
    
    .error {
        background: #fef2f2;
        color: #991b1b;
        border-left-color: var(--accent);
    }
    
    .info {
        background: #eff6ff;
        color: #1e40af;
        border-left-color: var(--primary);
    }
    
    .voice-controls {
        display: flex;
        gap: 12px;
        margin-top: 20px;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .oral-practice-content {
        background: white;
        padding: 32px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        border-left: 4px solid var(--accent);
        text-align: center;
    }
    
    .oral-practice-title {
        color: var(--dark);
        margin-bottom: 24px;
        font-weight: 700;
        font-size: 20px;
        letter-spacing: -0.025em;
    }
    
    .oral-instruction {
        margin-bottom: 28px;
        color: var(--dark);
        line-height: 1.7;
        font-size: 16px;
    }
    
    .recording-controls {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
        margin: 28px 0;
    }
    
    .record-btn {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: none;
        background: var(--light-gray);
        color: var(--gray);
        font-size: 28px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: var(--shadow);
    }
    
    .record-btn:hover {
        background: var(--primary);
        color: white;
        transform: scale(1.05);
    }
    
    .record-btn.recording {
        background: var(--accent);
        color: white;
        animation: pulse 1.5s infinite;
    }
    
    .recording-timer {
        font-size: 16px;
        color: var(--gray);
        font-weight: 600;
    }
    
    .audio-playback {
        width: 100%;
        margin: 24px 0;
    }
    
    .send-audio-btn {
        background: var(--secondary);
    }
    
    .send-audio-btn:hover {
        background: var(--secondary-dark);
    }
    
    .contact-form {
        display: none;
        background: white;
        padding: 28px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        margin-top: 20px;
        border-left: 4px solid var(--accent);
    }
    
    .contact-form h3 {
        color: var(--dark);
        margin-bottom: 20px;
        font-weight: 700;
        font-size: 20px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--dark);
    }
    
    .form-group input, .form-group textarea {
        width: 100%;
        padding: 16px;
        border-radius: 8px;
        border: 2px solid var(--border);
        font-family: inherit;
        font-size: 15px;
        transition: all 0.3s;
        font-weight: 500;
    }
    
    .form-group input:focus, .form-group textarea:focus {
        border-color: var(--primary);
        outline: none;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    .form-group textarea {
        min-height: 120px;
        resize: vertical;
    }
    
    .completion-message {
        text-align: center;
        padding: 48px 32px;
        background: white;
        border-radius: 12px;
        box-shadow: var(--shadow);
    }
    
    .completion-message h3 {
        color: var(--secondary);
        margin-bottom: 20px;
        font-size: 28px;
        font-weight: 700;
    }
    
    .completion-message p {
        margin-bottom: 16px;
        color: var(--dark);
        font-size: 18px;
    }
    
    .offline-notice {
        background: #fffbeb;
        color: #92400e;
        padding: 16px;
        border-radius: 8px;
        margin: 20px 0;
        border-left: 4px solid var(--accent);
        font-size: 14px;
        font-weight: 500;
    }
    
    @media (max-width: 768px) {
        .bot-container {
            padding: 24px;
        }
        
        .content-area {
            padding: 20px;
        }
        
        .navigation-buttons {
            flex-direction: column;
        }
        
        button {
            width: 100%;
        }
        
        .language-tabs {
            flex-direction: column;
        }
        
        .button-container {
            flex-direction: column;
        }
        
        .voice-controls {
            flex-direction: column;
        }
        
        .lesson-content, .exercise-content {
            padding: 20px;
        }
        
        .bot-header h2 {
            font-size: 24px;
        }
        
        .lesson-title {
            font-size: 20px;
        }
    }
</style>
</head>
<body>

<div class="bot-container">
    <div class="bot-header">
        <div class="bot-avatar">ü§ñ</div>
        <h2>Bot Enseignant Automatique</h2>
        <div class="bot-subtitle">Fran√ßais - Malagasy | 10 Le√ßons Compl√®tes</div>
    </div>
    
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    <div class="progress-text" id="progressText"></div>
    
    <div class="navigation-buttons">
        <button onclick="previousLesson()" id="prevLessonBtn" class="outline">‚Üê Le√ßon pr√©c√©dente</button>
        <button onclick="showOralPractice()" id="oralPracticeBtn" class="accent">üé§ Pratique Orale</button>
        <button onclick="showContactForm()" id="contactBtn" class="outline">Contact & Aide</button>
        <button onclick="nextLesson()" id="nextLessonBtn" class="outline">Nouvelle le√ßon ‚Üí</button>
    </div>
    
    <div class="content-area">
        <div class="typing-indicator" id="typingIndicator">
            Le bot est en train d'√©crire <span class="typing-dots"><span>.</span><span>.</span><span>.</span></span>
        </div>
        
        <div class="lesson-section" id="lessonSection">
            <div id="lessonContent"></div>
            <div class="button-container">
                <button onclick="startLesson()" id="startLessonBtn" class="secondary">Commencer les exercices</button>
                <button onclick="readAloud()" id="readAloudBtn" class="outline">üéß √âcouter la le√ßon</button>
            </div>
        </div>
        
        <div class="exercise-section" id="exerciseSection">
            <div id="exerciseContent"></div>
            <div class="button-container">
                <button onclick="submitAnswer()" id="submitBtn" class="secondary">Valider la r√©ponse</button>
                <button onclick="showCorrection()" id="correctionBtn" class="outline">Voir correction</button>
                <button onclick="backToLesson()" id="backBtn" class="outline">‚Üê Retour √† la le√ßon</button>
                <button onclick="nextExercise()" id="nextBtn">Exercice suivant ‚Üí</button>
            </div>
        </div>
        
        <div class="oral-practice-section" id="oralPracticeSection">
            <div class="oral-practice-content">
                <div class="oral-practice-title">üé§ Pratique Orale</div>
                <div class="oral-instruction">
                    <p>Enregistrez votre prononciation et envoyez-la pour √©valuation.</p>
                    <p><strong>Note:</strong> Cette fonctionnalit√© n√©cessite une connexion Internet.</p>
                </div>
                
                <div class="recording-controls">
                    <button class="record-btn" id="recordBtn">
                        üé§
                    </button>
                    <div class="recording-timer" id="recordingTimer">00:00</div>
                </div>
                
                <div class="audio-playback" id="audioPlayback" style="display: none;">
                    <audio controls id="recordedAudio"></audio>
                </div>
                
                <div class="button-container">
                    <button onclick="sendAudio()" id="sendAudioBtn" class="send-audio-btn" style="display: none;">
                        üì§ Envoyer l'audio
                    </button>
                    <button onclick="backToLesson()" class="outline">‚Üê Retour √† la le√ßon</button>
                </div>
                
                <div class="offline-notice" id="offlineNotice" style="display: none;">
                    ‚ö†Ô∏è Vous √™tes hors ligne. La pratique orale n√©cessite une connexion Internet.
                </div>
            </div>
        </div>
        
        <div class="contact-form" id="contactForm">
            <h3>Formulaire de Contact</h3>
            <p>Si le bot ne peut pas r√©pondre √† votre question, veuillez remplir ce formulaire :</p>
            
            <div class="form-group">
                <label for="email">Votre email :</label>
                <input type="email" id="email" placeholder="votre@email.com">
            </div>
            
            <div class="form-group">
                <label for="subject">Sujet :</label>
                <input type="text" id="subject" placeholder="Sujet de votre message">
            </div>
            
            <div class="form-group">
                <label for="messageText">Votre message :</label>
                <textarea id="messageText" placeholder="D√©crivez votre probl√®me ou question en d√©tail..."></textarea>
            </div>
            
            <div class="button-container">
                <button onclick="sendContactForm()" class="secondary">Envoyer le message</button>
                <button onclick="hideContactForm()" class="outline">Annuler</button>
            </div>
        </div>
        
        <div class="completion-message" id="completionMessage" style="display:none;">
            <h3>üéâ F√©licitations !</h3>
            <p>Vous avez termin√© toutes les le√ßons !</p>
            <p>Votre score final : <strong id="finalScore">0</strong> points</p>
            <div class="button-container" style="justify-content: center; margin-top: 20px;">
                <button onclick="resetAll()" class="secondary">Recommencer depuis le d√©but</button>
            </div>
        </div>
    </div>
    
    <div class="message" id="message"></div>
</div>

<script>
// Les 10 le√ßons compl√®tes avec les titres demand√©s
const lessons = [
    {
        id: 1,
        title: "LES NOMS ET LES ARTICLES",
        titleMg: "NY ANARANA SY NY LAHATSORATRA",
        description: {
            fr: "Comprendre les noms et les articles en fran√ßais : d√©finis, ind√©finis et partitifs.",
            mg: "Ny fahatakarana ny anarana sy ny lahatsoratra amin'ny teny frantsay: voafaritra, tsy voafaritra ary ampahany."
        },
        content: {
            fr: `
                <h4>Les Noms (Nouns)</h4>
                <p>En fran√ßais, les noms ont un genre (masculin/f√©minin) et un nombre (singulier/pluriel).</p>
                
                <h4>Suffixes des noms masculins</h4>
                <p>Les noms masculins se terminent souvent par :</p>
                <ul>
                    <li><strong>-age</strong> : le voyage, le fromage, le garage</li>
                    <li><strong>-ment</strong> : le gouvernement, le traitement, le mouvement</li>
                    <li><strong>-eau</strong> : le ch√¢teau, le bateau, le manteau</li>
                    <li><strong>-isme</strong> : le capitalisme, le tourisme, l'optimisme</li>
                    <li><strong>-ier</strong> : le fermier, le pommier, le cahier</li>
                    <li><strong>-on</strong> : le ballon, le wagon, le ponton</li>
                    <li><strong>-in</strong> : le jardin, le matin, le chemin</li>
                </ul>
                
                <h4>Suffixes des noms f√©minins</h4>
                <p>Les noms f√©minins se terminent souvent par :</p>
                <ul>
                    <li><strong>-tion</strong> : la nation, la situation, l'√©ducation</li>
                    <li><strong>-sion</strong> : la t√©l√©vision, la d√©cision, la passion</li>
                    <li><strong>-t√©</strong> : la beaut√©, la libert√©, la sant√©</li>
                    <li><strong>-i√®re</strong> : la fermi√®re, la pommi√®re, la lumi√®re</li>
                    <li><strong>-esse</strong> : la richesse, la tristesse, la jeunesse</li>
                    <li><strong>-ette</strong> : la chaussette, la fourchette, l'allumette</li>
                    <li><strong>-ade</strong> : la promenade, la limonade, la salade</li>
                </ul>
                
                <h4>Les Articles D√©finis</h4>
                <p>‚Ä¢ <strong>le</strong> - masculin singulier (le livre)</p>
                <p>‚Ä¢ <strong>la</strong> - f√©minin singulier (la table)</p>
                <p>‚Ä¢ <strong>l'</strong> - devant une voyelle (l'√©cole)</p>
                <p>‚Ä¢ <strong>les</strong> - pluriel (les livres, les tables)</p>
                
                <h4>Les Articles Ind√©finis</h4>
                <p>‚Ä¢ <strong>un</strong> - masculin singulier (un livre)</p>
                <p>‚Ä¢ <strong>une</strong> - f√©minin singulier (une table)</p>
                <p>‚Ä¢ <strong>des</strong> - pluriel (des livres, des tables)</p>
                
                <h4>Les Articles Partitifs</h4>
                <p>‚Ä¢ <strong>du</strong> - masculin (du pain)</p>
                <p>‚Ä¢ <strong>de la</strong> - f√©minin (de la confiture)</p>
                <p>‚Ä¢ <strong>de l'</strong> - devant voyelle (de l'eau)</p>
                <p>‚Ä¢ <strong>des</strong> - pluriel (des l√©gumes)</p>
            `,
            mg: `
                <h4>Ny Anarana (Nouns)</h4>
                <p>Amin'ny teny frantsay, ny anarana dia manana lahy sy vavy ary isa (tokana/maro).</p>
                
                <h4>Suffixe an'ny anarana lahy</h4>
                <p>Ny anarana lahy dia mifarana amin'ny :</p>
                <ul>
                    <li><strong>-age</strong> : ny dia, ny fromazy, ny garazy</li>
                    <li><strong>-ment</strong> : ny governemanta, ny fitsaboana, ny fihetsehana</li>
                    <li><strong>-eau</strong> : ny lapa, ny sambo, ny palitao</li>
                </ul>
                
                <h4>Suffixe an'ny anarana vavy</h4>
                <p>Ny anarana vavy dia mifarana amin'ny :</p>
                <ul>
                    <li><strong>-tion</strong> : ny firenena, ny toe-javatra, ny fanabeazana</li>
                    <li><strong>-sion</strong> : ny fahitalavitra, ny fanapahan-kevitra, ny fitiavan-tanindrazana</li>
                    <li><strong>-t√©</strong> : ny hatsarana, ny fahafahana, ny fahasalamana</li>
                </ul>
            `
        },
        image: "üìö",
        exercises: [
            {
                question: "Completez avec l'article d√©fini : ___ maison est grande.",
                questionMg: "Fenoy amin'ny lahatsoratra voafaritra : ___ maison est grande.",
                answer: "la",
                correction: "la maison est grande - 'maison' est un nom f√©minin singulier"
            },
            {
                question: "Completez avec l'article ind√©fini : J'ai ___ chat noir.",
                questionMg: "Fenoy amin'ny lahatsoratra tsy voafaritra : J'ai ___ chat noir.",
                answer: "un",
                correction: "J'ai un chat noir - 'chat' est un nom masculin singulier"
            },
            {
                question: "Completez avec l'article partitif : Je mange ___ pain.",
                questionMg: "Fenoy amin'ny lahatsoratra ampahany : Je mange ___ pain.",
                answer: "du",
                correction: "Je mange du pain - 'pain' est un nom masculin non comptable"
            }
        ]
    },
    {
        id: 2,
        title: "EMPLOIS DU VERBE DEVOIR DANS UNE PHRASE",
        titleMg: "NY FAMPIASANA NY MATOANTENY DEVOIR AMINNY FEHENTENY",
        description: {
            fr: "Ma√Ætriser les diff√©rentes utilisations du verbe devoir dans des contextes vari√©s.",
            mg: "Ny fahafantarana ny fampiasana samihafa amin'ny matoanteny devoir amin'ny toe-javatra isan-karazany."
        },
        content: {
            fr: `
                <h4>Le Verbe DEVOIR - Conjugaison au Pr√©sent</h4>
                <p>‚Ä¢ Je dois</p>
                <p>‚Ä¢ Tu dois</p>
                <p>‚Ä¢ Il/Elle doit</p>
                <p>‚Ä¢ Nous devons</p>
                <p>‚Ä¢ Vous devez</p>
                <p>‚Ä¢ Ils/Elles doivent</p>
                
                <h4>Les diff√©rents emplois de DEVOIR :</h4>
                
                <h5>1. Expression de l'obligation</h5>
                <p>‚Ä¢ <strong>Je dois √©tudier</strong> - I have to study (obligation forte)</p>
                <p>‚Ä¢ <strong>Tu dois finir ton travail</strong> - You must finish your work</p>
                
                <h5>2. Expression de la probabilit√©</h5>
                <p>‚Ä¢ <strong>Il doit √™tre fatigu√©</strong> - He must be tired (supposition)</p>
                <p>‚Ä¢ <strong>Elle doit arriver bient√¥t</strong> - She should arrive soon</p>
                
                <h5>3. Expression du conseil</h5>
                <p>‚Ä¢ <strong>Tu devrais te reposer</strong> - You should rest (conseil)</p>
                <p>‚Ä¢ <strong>Nous devrions partir t√¥t</strong> - We should leave early</p>
            `,
            mg: `
                <h4>Ny matoanteny DEVOIR - Conjugaison amin'ny Pr√©sent</h4>
                <p>‚Ä¢ Izaho dia tokony</p>
                <p>‚Ä¢ Ian√£o dia tokony</p>
                <p>‚Ä¢ Izy dia tokony</p>
                <p>‚Ä¢ Izahay dia tokony</p>
                <p>‚Ä¢ Ianareo dia tokony</p>
                <p>‚Ä¢ Izy ireo dia tokony</p>
            `
        },
        image: "‚öñÔ∏è",
        exercises: [
            {
                question: "Completez : Je ___ faire mes devoirs.",
                questionMg: "Fenoy : Je ___ faire mes devoirs.",
                answer: "dois",
                correction: "Je dois faire mes devoirs - expression d'obligation"
            },
            {
                question: "Completez : Il ___ √™tre malade, il a de la fi√®vre.",
                questionMg: "Fenoy : Il ___ √™tre malade, il a de la fi√®vre.",
                answer: "doit",
                correction: "Il doit √™tre malade - expression de probabilit√©"
            },
            {
                question: "Completez : Tu ___ visiter ce mus√©e, il est magnifique.",
                questionMg: "Fenoy : Tu ___ visiter ce mus√©e, il est magnifique.",
                answer: "devrais",
                correction: "Tu devrais visiter ce mus√©e - expression de conseil"
            }
        ]
    },
    {
        id: 3,
        title: "LE TEMPS ET LES AUXILIAIRES",
        titleMg: "NY FOTOANA SY NY MPANAMPY",
        description: {
            fr: "Comprendre les diff√©rents temps verbaux et l'utilisation des auxiliaires √™tre et avoir.",
            mg: "Ny fahatakarana ny fotoana samihafa amin'ny matoanteny sy ny fampiasana ny mpanampy √™tre sy avoir."
        },
        content: {
            fr: `
                <h4>Les Auxiliaires √äTRE et AVOIR</h4>
                <p>Ces deux verbes sont essentiels pour former les temps compos√©s.</p>
                
                <h4>Conjugaison des Auxiliaires au Pr√©sent</h4>
                <p><strong>√äTRE :</strong> je suis, tu es, il/elle est, nous sommes, vous √™tes, ils/elles sont</p>
                <p><strong>AVOIR :</strong> j'ai, tu as, il/elle a, nous avons, vous avez, ils/elles ont</p>
                
                <h4>Formation des Temps Compos√©s</h4>
                <p>‚Ä¢ <strong>Pass√© compos√©</strong> : auxiliaire + participe pass√©</p>
                <p>‚Ä¢ <strong>Plus-que-parfait</strong> : auxiliaire √† l'imparfait + participe pass√©</p>
                <p>‚Ä¢ <strong>Futur ant√©rieur</strong> : auxiliaire au futur + participe pass√©</p>
            `,
            mg: `
                <h4>Ny Mpanampy √äTRE sy AVOIR</h4>
                <p>Ireo matoanteny roa ireo dia tena ilaina amin'ny fananganana ny fotoana mitambatra.</p>
            `
        },
        image: "‚è∞",
        exercises: [
            {
                question: "Completez avec l'auxiliaire : Elle ___ mang√© une pomme.",
                questionMg: "Fenoy amin'ny mpanampy : Elle ___ mang√© une pomme.",
                answer: "a",
                correction: "Elle a mang√© une pomme - 'manger' utilise l'auxiliaire AVOIR"
            },
            {
                question: "Completez : Nous ___ all√©s au cin√©ma.",
                questionMg: "Fenoy : Nous ___ all√©s au cin√©ma.",
                answer: "sommes",
                correction: "Nous sommes all√©s au cin√©ma - 'aller' utilise l'auxiliaire √äTRE"
            }
        ]
    },
    {
        id: 4,
        title: "TOUS LES SALUTATIONS QUOTIDIENNES",
        titleMg: "NY FIARAHABANA ANDRO ANDROAMIN'NY",
        description: {
            fr: "Apprendre toutes les salutations utilis√©es dans la vie quotidienne en fran√ßais.",
            mg: "Fianarana ny fiarahabana rehetra ampiasaina amin'ny fiainana andavanandro amin'ny teny frantsay."
        },
        content: {
            fr: `
                <h4>Salutations selon le moment de la journ√©e</h4>
                
                <h5>Le Matin (jusqu'√† 12h)</h5>
                <p>‚Ä¢ <strong>Bonjour</strong> - Salutation standard</p>
                <p>‚Ä¢ <strong>Salut</strong> - Informel entre amis</p>
                <p>‚Ä¢ <strong>Bonne matin√©e</strong> - Quand on quitte quelqu'un le matin</p>
                
                <h5>L'Apr√®s-midi (12h-18h)</h5>
                <p>‚Ä¢ <strong>Bonjour</strong> - Toujours utilis√©</p>
                <p>‚Ä¢ <strong>Bon apr√®s-midi</strong> - Quand on quitte quelqu'un l'apr√®s-midi</p>
                
                <h5>Le Soir (apr√®s 18h)</h5>
                <p>‚Ä¢ <strong>Bonsoir</strong> - Salutation du soir</p>
                <p>‚Ä¢ <strong>Bonne soir√©e</strong> - Quand on quitte quelqu'un le soir</p>
                <p>‚Ä¢ <strong>Bonne nuit</strong> - Avant d'aller dormir</p>
            `,
            mg: `
                <h4>Fiarahabana araka ny fotoana amin'ny andro</h4>
                
                <h5>Ny Maraina (hatramin'ny 12h)</h5>
                <p>‚Ä¢ <strong>Bonjour</strong> - Fiarahabana mahazatra</p>
                <p>‚Ä¢ <strong>Salut</strong> - Tsy ara-pomba eo amin'ny namana</p>
            `
        },
        image: "üëã",
        exercises: [
            {
                question: "Completez la salutation du matin : ___ !",
                questionMg: "Fenoy ny fiarahabana maraina : ___ !",
                answer: "bonjour",
                correction: "Bonjour ! - Salutation standard pour le matin"
            },
            {
                question: "Completez : ___ soir ! (salutation du soir)",
                questionMg: "Fenoy : ___ soir ! (fiarahabana hariva)",
                answer: "bonsoir",
                correction: "Bonsoir ! - Salutation utilis√©e le soir"
            }
        ]
    },
    {
        id: 5,
        title: "LE GROUPE DE VERBES",
        titleMg: "NY VONDROM-PANAMPY",
        description: {
            fr: "Comprendre les trois groupes de verbes en fran√ßais et leurs conjugaisons.",
            mg: "Ny fahatakarana ny vondrom-panampy telo amin'ny teny frantsay sy ny conjugation azy."
        },
        content: {
            fr: `
                <h4>Les Trois Groupes de Verbes</h4>
                
                <h5>1er Groupe : Verbes en -ER (sauf aller)</h5>
                <p>‚Ä¢ Exemples : parler, manger, chanter, danser</p>
                <p>‚Ä¢ Caract√©ristique : Verbes r√©guliers</p>
                
                <h5>2√®me Groupe : Verbes en -IR</h5>
                <p>‚Ä¢ Exemples : finir, choisir, r√©ussir, grandir</p>
                <p>‚Ä¢ Caract√©ristique : Verbes r√©guliers avec -iss- √† certaines formes</p>
                
                <h5>3√®me Groupe : Tous les autres verbes</h5>
                <p>‚Ä¢ Exemples : √™tre, avoir, faire, dire, prendre, venir</p>
                <p>‚Ä¢ Caract√©ristique : Verbes irr√©guliers</p>
            `,
            mg: `
                <h4>Ny Vondrom-panampy Telon'ny matoanteny</h4>
                
                <h5>1er Groupe : matoanteny amin'ny -ER (afa-tsy aller)</h5>
                <p>‚Ä¢ Ohatra : miteny, mihinana, mihira, mandihy</p>
            `
        },
        image: "üìù",
        exercises: [
            {
                question: "√Ä quel groupe appartient le verbe 'manger' ?",
                questionMg: "Amin'ny vondrona inona no an'ny matoanteny 'manger' ?",
                answer: "1",
                correction: "Le verbe 'manger' appartient au 1er groupe (verbes en -ER)"
            },
            {
                question: "Conjuguez 'finir' √† la 3√®me personne du singulier : il ___",
                questionMg: "Conjuguez 'finir' amin'ny endrika tokana fahatelo : il ___",
                answer: "finit",
                correction: "Il finit - verbe du 2√®me groupe"
            }
        ]
    },
    {
        id: 6,
        title: "EMPLOIS DU VERBE CUISINER DANS UNE PHRASE",
        titleMg: "NY FAMPIASANA NY MATOANTENY CUISINER AMINNY FEHENTENY",
        description: {
            fr: "Ma√Ætriser l'utilisation du verbe cuisiner dans diff√©rents contextes et phrases.",
            mg: "Ny fahafantarana ny fampiasana ny matoanteny cuisiner amin'ny fehenteny sy toe-javatra samihafa."
        },
        content: {
            fr: `
                <h4>Le Verbe CUISINER - Conjugaison</h4>
                <p>‚Ä¢ Je cuisine</p>
                <p>‚Ä¢ Tu cuisines</p>
                <p>‚Ä¢ Il/Elle cuisine</p>
                <p>‚Ä¢ Nous cuisinons</p>
                <p>‚Ä¢ Vous cuisinez</p>
                <p>‚Ä¢ Ils/Elles cuisinent</p>
                
                <h4>Diff√©rents emplois de CUISINER</h4>
                
                <h5>1. Action de pr√©parer des aliments</h5>
                <p>‚Ä¢ <strong>Je cuisine le d√Æner</strong> - I cook dinner</p>
                <p>‚Ä¢ <strong>Elle cuisine tr√®s bien</strong> - She cooks very well</p>
                
                <h5>2. Profession ou hobby</h5>
                <p>‚Ä¢ <strong>Il cuisine dans un restaurant</strong> - He cooks in a restaurant</p>
                <p>‚Ä¢ <strong>Nous cuisinons pour nos amis</strong> - We cook for our friends</p>
            `,
            mg: `
                <h4>Ny matoanteny CUISINER - Conjugation</h4>
                <p>‚Ä¢ Izaho mahandro</p>
                <p>‚Ä¢ Ian√£o mahandro</p>
                <p>‚Ä¢ Izy mahandro</p>
            `
        },
        image: "üë®‚Äçüç≥",
        exercises: [
            {
                question: "Completez : Je ___ le d√Æner ce soir.",
                questionMg: "Fenoy : Je ___ le d√Æner ce soir.",
                answer: "cuisine",
                correction: "Je cuisine le d√Æner ce soir - action au pr√©sent"
            },
            {
                question: "Completez : Elles ___ pour leurs enfants.",
                questionMg: "Fenoy : Elles ___ pour leurs enfants.",
                answer: "cuisinent",
                correction: "Elles cuisinent pour leurs enfants - pluriel f√©minin"
            }
        ]
    },
    {
        id: 7,
        title: "EMPLOIS TOUS LES PR√âPOSITIONS AVEC UNE PHRASE ET LEUR SENS UNIQUEMENT",
        titleMg: "NY FAMPIASANA NY PREPOSITION REHETRA AMINNY FEHENTENY SY NY HEOHEVINY MANOKANA",
        description: {
            fr: "Comprendre toutes les pr√©positions fran√ßaises et leurs sens sp√©cifiques dans des phrases.",
            mg: "Ny fahatakarana ny preposition frantsay rehetra sy ny heviny manokana amin'ny fehenteny."
        },
        content: {
            fr: `
                <h4>Les Pr√©positions Essentielles</h4>
                
                <h5>√Ä - Utilisations principales</h5>
                <p>‚Ä¢ <strong>Lieu</strong> : Je vais √† Paris</p>
                <p>‚Ä¢ <strong>Moment</strong> : √Ä demain, √† 8 heures</p>
                <p>‚Ä¢ <strong>Mani√®re</strong> : √Ä pied, √† v√©lo</p>
                
                <h5>DE - Utilisations principales</h5>
                <p>‚Ä¢ <strong>Origine</strong> : Je viens de France</p>
                <p>‚Ä¢ <strong>Appartenance</strong> : Le livre de Paul</p>
                <p>‚Ä¢ <strong>Mati√®re</strong> : Une table de bois</p>
            `,
            mg: `
                <h4>Ny Preposition Tena Ilaina</h4>
                
                <h5>√Ä - Fampiasana fototra</h5>
                <p>‚Ä¢ <strong>Toerana</strong> : Handeha any Paris aho</p>
            `
        },
        image: "üìç",
        exercises: [
            {
                question: "Completez : Je vais ___ Paris.",
                questionMg: "Fenoy : Je vais ___ Paris.",
                answer: "√†",
                correction: "Je vais √† Paris - pr√©position de lieu pour les villes"
            },
            {
                question: "Completez : Il vient ___ France.",
                questionMg: "Fenoy : Il vient ___ France.",
                answer: "de",
                correction: "Il vient de France - pr√©position d'origine"
            }
        ]
    },
    {
        id: 8,
        title: "APPRENDRE LES TEMPS COMPOS√âS ET LE TEMPS SIMPLE",
        titleMg: "FIANARANA NY FOTOANA MITAMBATRA SY NY FOTOANA TSOTRA",
        description: {
            fr: "Ma√Ætriser la diff√©rence entre les temps simples et les temps compos√©s en fran√ßais.",
            mg: "Ny fahafantarana ny fahasamihafana eo amin'ny fotoana tsotra sy ny fotoana mitambatra amin'ny teny frantsay."
        },
        content: {
            fr: `
                <h4>Les Temps Simples</h4>
                <p>Les temps simples se conjuguent en un seul mot.</p>
                
                <h5>Pr√©sent de l'indicatif</h5>
                <p>‚Ä¢ Action actuelle ou habituelle</p>
                <p>‚Ä¢ Exemple : Je mange une pomme</p>
                
                <h5>Imparfait</h5>
                <p>‚Ä¢ Action pass√©e habituelle ou description</p>
                <p>‚Ä¢ Exemple : Quand j'√©tais jeune, je jouais au football</p>
                
                <h5>Futur simple</h5>
                <p>‚Ä¢ Action future</p>
                <p>‚Ä¢ Exemple : Je viendrai demain</p>
            `,
            mg: `
                <h4>Ny Fotoana Tsotra</h4>
                <p>Ny fotoana tsotra dia conjugaison amin'ny teny iray.</p>
            `
        },
        image: "‚è≥",
        exercises: [
            {
                question: "Quel temps est 'je mange' ?",
                questionMg: "Inona ny fotoana amin'ny 'je mange' ?",
                answer: "pr√©sent",
                correction: "'je mange' est au pr√©sent - temps simple"
            },
            {
                question: "Quel temps est 'j'ai mang√©' ?",
                questionMg: "Inona ny fotoana amin'ny 'j'ai mang√©' ?",
                answer: "pass√© compos√©",
                correction: "'j'ai mang√©' est au pass√© compos√© - temps compos√©"
            }
        ]
    },
    {
        id: 9,
        title: "APPRENDRE TOUS LES PARTICIPES PASS√âS POSSIBLES",
        titleMg: "FIANARANA NY PARTICIPE PASS√â REHETRA AZO ATAO",
        description: {
            fr: "Ma√Ætriser la formation et l'accord de tous les participes pass√©s en fran√ßais.",
            mg: "Ny fahafantarana ny fananganana sy ny fifanarahana ny participe pass√© rehetra amin'ny teny frantsay."
        },
        content: {
            fr: `
                <h4>Qu'est-ce qu'un Participe Pass√© ?</h4>
                <p>Le participe pass√© est une forme verbale utilis√©e dans les temps compos√©s.</p>
                
                <h4>Formation des Participes Pass√©s</h4>
                
                <h5>1er Groupe (-ER) ‚Üí -√â</h5>
                <p>‚Ä¢ Parler ‚Üí parl√©</p>
                <p>‚Ä¢ Manger ‚Üí mang√©</p>
                <p>‚Ä¢ Danser ‚Üí dans√©</p>
                
                <h5>2√®me Groupe (-IR) ‚Üí -I</h5>
                <p>‚Ä¢ Finir ‚Üí fini</p>
                <p>‚Ä¢ Choisir ‚Üí choisi</p>
                <p>‚Ä¢ R√©ussir ‚Üí r√©ussi</p>
                
                <h5>3√®me Groupe - Formes irr√©guli√®res</h5>
                <p>‚Ä¢ Avoir ‚Üí eu</p>
                <p>‚Ä¢ √ätre ‚Üí √©t√©</p>
                <p>‚Ä¢ Faire ‚Üí fait</p>
                <p>‚Ä¢ Prendre ‚Üí pris</p>
                <p>‚Ä¢ Venir ‚Üí venu</p>
            `,
            mg: `
                <h4>Inona ny Participe Pass√© ?</h4>
                <p>Ny participe pass√© dia endrika matoanteny ampiasaina amin'ny fotoana mitambatra.</p>
            `
        },
        image: "üìÑ",
        exercises: [
            {
                question: "Quel est le participe pass√© de 'manger' ?",
                questionMg: "Inona ny participe pass√© amin'ny 'manger' ?",
                answer: "mang√©",
                correction: "mang√© - verbe du 1er groupe"
            },
            {
                question: "Quel est le participe pass√© de 'finir' ?",
                questionMg: "Inona ny participe pass√© amin'ny 'finir' ?",
                answer: "fini",
                correction: "fini - verbe du 2√®me groupe"
            }
        ]
    },
    {
        id: 10,
        title: "APPRENDRE TOUS LES ADJECTIFS",
        titleMg: "FIANARANA NY ADJECTIF REHETRA",
        description: {
            fr: "Ma√Ætriser les adjectifs fran√ßais : accord, position et utilisation.",
            mg: "Ny fahafantarana ny adjective frantsay : fifanarahana, toerana ary fampiasana."
        },
        content: {
            fr: `
                <h4>Qu'est-ce qu'un Adjectif ?</h4>
                <p>Un adjectif qualificatif donne une caract√©ristique √† un nom.</p>
                
                <h4>Accord des Adjectifs</h4>
                <p>Les adjectifs s'accordent en genre et en nombre avec le nom qu'ils qualifient.</p>
                
                <h5>Accord avec le genre</h5>
                <p>‚Ä¢ Masculin : un livre int√©ressant</p>
                <p>‚Ä¢ F√©minin : une histoire int√©ressante</p>
                
                <h5>Accord avec le nombre</h5>
                <p>‚Ä¢ Singulier : un enfant intelligent</p>
                <p>‚Ä¢ Pluriel : des enfants intelligents</p>
            `,
            mg: `
                <h4>Inona ny Adjective ?</h4>
                <p>Adjectif qualificatif dia manome toetra ho an'ny anarana.</p>
            `
        },
        image: "üé®",
        exercises: [
            {
                question: "Accordez l'adjectif : un livre ___ (int√©ressant)",
                questionMg: "Araho ny adjective : un livre ___ (int√©ressant)",
                answer: "int√©ressant",
                correction: "un livre int√©ressant - masculin singulier"
            },
            {
                question: "Accordez : une histoire ___ (int√©ressant)",
                questionMg: "Araho : une histoire ___ (int√©ressant)",
                answer: "int√©ressante",
                correction: "une histoire int√©ressante - f√©minin singulier"
            }
        ]
    }
];

// R√©cup√©rer l'√©tat depuis localStorage
let currentLessonIndex = parseInt(localStorage.getItem("currentLessonIndex")) || 0;
let currentExerciseIndex = parseInt(localStorage.getItem("currentExerciseIndex")) || 0;
let score = parseInt(localStorage.getItem("score")) || 0;
let speechSynthesis = window.speechSynthesis;
let recognition = null;
let mediaRecorder = null;
let audioChunks = [];
let recordingTimer = null;
let recordingSeconds = 0;

// Initialiser la reconnaissance vocale si disponible
if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
    recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.continuous = false;
    recognition.lang = 'fr-FR';
    recognition.interimResults = false;
}

// V√©rifier la connexion Internet
function checkOnlineStatus() {
    if (!navigator.onLine) {
        document.getElementById('offlineNotice').style.display = 'block';
        return false;
    }
    document.getElementById('offlineNotice').style.display = 'none';
    return true;
}

// Mettre √† jour la barre de progression
function updateProgress() {
    const totalExercises = lessons.reduce((total, lesson) => total + lesson.exercises.length, 0);
    const completedExercises = lessons.slice(0, currentLessonIndex).reduce((total, lesson) => total + lesson.exercises.length, 0) + currentExerciseIndex;
    const progressPercentage = (completedExercises / totalExercises) * 100;
    
    document.getElementById("progressBar").style.width = `${progressPercentage}%`;
    document.getElementById("progressText").textContent = 
        `Progression: ${Math.round(progressPercentage)}% | Le√ßon ${currentLessonIndex + 1}/${lessons.length} | Score: ${score}`;
}

// Afficher la le√ßon actuelle avec d√©lai
function showLesson() {
    if(currentLessonIndex >= lessons.length) {
        document.getElementById("finalScore").textContent = score;
        document.getElementById("completionMessage").style.display = "block";
        document.getElementById("lessonSection").style.display = "none";
        document.getElementById("exerciseSection").style.display = "none";
        updateProgress();
        return;
    }
    
    // Afficher l'indicateur de frappe
    document.getElementById("typingIndicator").style.display = "block";
    document.getElementById("lessonSection").style.display = "none";
    document.getElementById("exerciseSection").style.display = "none";
    document.getElementById("oralPracticeSection").style.display = "none";
    document.getElementById("contactForm").style.display = "none";
    
    // D√©lai de 5 secondes
    setTimeout(() => {
        document.getElementById("typingIndicator").style.display = "none";
        document.getElementById("lessonSection").style.display = "block";
        
        const lesson = lessons[currentLessonIndex];
        let content = `
            <div class="lesson-title">${lesson.title} | ${lesson.titleMg}</div>
            <div class="lesson-desc">
                <strong>Fran√ßais:</strong> ${lesson.description.fr}<br>
                <strong>Malagasy:</strong> ${lesson.description.mg}
            </div>
            
            <div class="language-tabs">
                <div class="language-tab active" onclick="switchLanguage('fr')">Fran√ßais</div>
                <div class="language-tab" onclick="switchLanguage('mg')">Malagasy</div>
            </div>
            
            <div class="language-content active" id="frContent">
                ${lesson.content.fr}
            </div>
            
            <div class="language-content" id="mgContent">
                ${lesson.content.mg}
            </div>
            
            <div class="lesson-image">${lesson.image}</div>
        `;
        
        document.getElementById("lessonContent").innerHTML = content;
        
        // Mettre √† jour les boutons de navigation
        document.getElementById("prevLessonBtn").style.display = currentLessonIndex > 0 ? "inline-block" : "none";
        document.getElementById("nextLessonBtn").style.display = currentLessonIndex < lessons.length - 1 ? "inline-block" : "none";
        
        updateProgress();
    }, 5000);
}

// Changer la langue d'affichage
function switchLanguage(lang) {
    document.querySelectorAll('.language-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    document.querySelectorAll('.language-content').forEach(content => {
        content.classList.remove('active');
    });
    
    document.querySelector(`.language-tab:nth-child(${lang === 'fr' ? 1 : 2})`).classList.add('active');
    document.getElementById(`${lang}Content`).classList.add('active');
}

// Commencer les exercices de la le√ßon actuelle
function startLesson() {
    document.getElementById("typingIndicator").style.display = "block";
    document.getElementById("lessonSection").style.display = "none";
    
    setTimeout(() => {
        document.getElementById("typingIndicator").style.display = "none";
        document.getElementById("exerciseSection").style.display = "block";
        currentExerciseIndex = 0;
        localStorage.setItem("currentExerciseIndex", currentExerciseIndex);
        showExercise();
    }, 3000);
}

// Retourner √† la le√ßon depuis les exercices
function backToLesson() {
    document.getElementById("exerciseSection").style.display = "none";
    document.getElementById("oralPracticeSection").style.display = "none";
    document.getElementById("contactForm").style.display = "none";
    document.getElementById("lessonSection").style.display = "block";
    document.getElementById("message").textContent = "";
    document.getElementById("message").className = "message";
}

// Aller √† la le√ßon pr√©c√©dente
function previousLesson() {
    if(currentLessonIndex > 0) {
        currentLessonIndex--;
        localStorage.setItem("currentLessonIndex", currentLessonIndex);
        showLesson();
    }
}

// Aller √† la le√ßon suivante
function nextLesson() {
    if(currentLessonIndex < lessons.length - 1) {
        currentLessonIndex++;
        localStorage.setItem("currentLessonIndex", currentLessonIndex);
        showLesson();
    }
}

// Afficher exercice actuel
function showExercise() {
    const exercises = lessons[currentLessonIndex].exercises;
    if(currentExerciseIndex >= exercises.length) {
        // Tous les exercices de cette le√ßon sont termin√©s
        document.getElementById("message").textContent = "üéâ F√©licitations ! Vous avez termin√© tous les exercices de cette le√ßon !";
        document.getElementById("message").className = "message success";
        
        // Retour automatique √† la le√ßon apr√®s 3 secondes
        setTimeout(() => {
            backToLesson();
        }, 3000);
        return;
    }
    
    const ex = exercises[currentExerciseIndex];
    let content = `
        <div class="exercise-counter">
            Exercice ${currentExerciseIndex + 1}/${exercises.length} - Le√ßon ${currentLessonIndex + 1}/${lessons.length}
        </div>
        <div class="exercise-question">
            ${ex.question}<br>
            <small style="color: var(--gray);">${ex.questionMg}</small>
        </div>
        <div class="input-group">
            <input type="text" id="userAnswer" placeholder="√âcrivez votre r√©ponse ici...">
            <button class="voice-input-btn" id="voiceInputBtn" title="R√©ponse vocale">üé§</button>
        </div>
    `;
    
    document.getElementById("exerciseContent").innerHTML = content;
    
    // Ajouter l'√©v√©nement pour le bouton de reconnaissance vocale
    document.getElementById("voiceInputBtn").addEventListener("click", startVoiceRecognition);
    
    document.getElementById("message").textContent = "";
    document.getElementById("message").className = "message";
    document.getElementById("nextBtn").style.display = "none";
    document.getElementById("submitBtn").style.display = "inline-block";
    document.getElementById("correctionBtn").style.display = "inline-block";
    
    updateProgress();
}

// V√©rification de la r√©ponse
function submitAnswer() {
    const exercises = lessons[currentLessonIndex].exercises;
    const ex = exercises[currentExerciseIndex];
    const userAnswer = document.getElementById("userAnswer").value.trim().toLowerCase();
    const correctAnswer = ex.answer.toLowerCase();

    if(userAnswer === correctAnswer) {
        document.getElementById("message").textContent = "Bravo ! ‚úÖ R√©ponse correcte !";
        document.getElementById("message").className = "message success";
        score += 10;
        localStorage.setItem("score", score);
        document.getElementById("submitBtn").style.display = "none";
        document.getElementById("correctionBtn").style.display = "none";
        document.getElementById("nextBtn").style.display = "inline-block";
        updateProgress();
    } else {
        document.getElementById("message").textContent = "Ce n'est pas correct. üòÖ Essayez encore ou regardez la correction.";
        document.getElementById("message").className = "message error";
    }
}

// Montrer correction
function showCorrection() {
    const exercises = lessons[currentLessonIndex].exercises;
    const ex = exercises[currentExerciseIndex];
    document.getElementById("message").textContent = "Correction : " + ex.correction;
    document.getElementById("message").className = "message info";
    document.getElementById("submitBtn").style.display = "none";
    document.getElementById("correctionBtn").style.display = "none";
    document.getElementById("nextBtn").style.display = "inline-block";
}

// Passer √† l'exercice suivant
function nextExercise() {
    currentExerciseIndex++;
    localStorage.setItem("currentExerciseIndex", currentExerciseIndex);
    showExercise();
}

// Lire la le√ßon √† haute voix
function readAloud() {
    if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
        return;
    }
    
    const lesson = lessons[currentLessonIndex];
    const text = `${lesson.title}. ${lesson.description.fr}. ${lesson.content.fr.replace(/<[^>]*>/g, '')}`;
    
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'fr-FR';
    utterance.rate = 0.9;
    
    speechSynthesis.speak(utterance);
}

// Lire la question √† haute voix
function readQuestionAloud() {
    if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
        return;
    }
    
    const exercises = lessons[currentLessonIndex].exercises;
    const ex = exercises[currentExerciseIndex];
    const text = ex.question;
    
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'fr-FR';
    utterance.rate = 0.9;
    
    speechSynthesis.speak(utterance);
}

// D√©marrer la reconnaissance vocale
function startVoiceRecognition() {
    if (!recognition) {
        alert("La reconnaissance vocale n'est pas support√©e par votre navigateur.");
        return;
    }
    
    const voiceBtn = document.getElementById("voiceInputBtn");
    voiceBtn.classList.add("recording");
    voiceBtn.innerHTML = "‚óè";
    
    recognition.start();
    
    recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        document.getElementById("userAnswer").value = transcript;
        voiceBtn.classList.remove("recording");
        voiceBtn.innerHTML = "üé§";
    };
    
    recognition.onerror = function(event) {
        console.error("Erreur de reconnaissance vocale:", event.error);
        voiceBtn.classList.remove("recording");
        voiceBtn.innerHTML = "üé§";
    };
    
    recognition.onend = function() {
        voiceBtn.classList.remove("recording");
        voiceBtn.innerHTML = "üé§";
    };
}

// Afficher la pratique orale
function showOralPractice() {
    if (!checkOnlineStatus()) {
        return;
    }
    
    document.getElementById("lessonSection").style.display = "none";
    document.getElementById("exerciseSection").style.display = "none";
    document.getElementById("contactForm").style.display = "none";
    document.getElementById("oralPracticeSection").style.display = "block";
    
    // R√©initialiser l'√©tat d'enregistrement
    document.getElementById("recordBtn").classList.remove("recording");
    document.getElementById("recordBtn").innerHTML = "üé§";
    document.getElementById("recordingTimer").textContent = "00:00";
    document.getElementById("audioPlayback").style.display = "none";
    document.getElementById("sendAudioBtn").style.display = "none";
    recordingSeconds = 0;
}

// D√©marrer l'enregistrement audio
async function startRecording() {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert("L'enregistrement audio n'est pas support√© par votre navigateur.");
        return;
    }
    
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];
        
        mediaRecorder.ondataavailable = (event) => {
            audioChunks.push(event.data);
        };
        
        mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            const audioUrl = URL.createObjectURL(audioBlob);
            const audioElement = document.getElementById("recordedAudio");
            audioElement.src = audioUrl;
            document.getElementById("audioPlayback").style.display = "block";
            document.getElementById("sendAudioBtn").style.display = "inline-block";
            
            // Arr√™ter tous les tracks du stream
            stream.getTracks().forEach(track => track.stop());
        };
        
        mediaRecorder.start();
        document.getElementById("recordBtn").classList.add("recording");
        document.getElementById("recordBtn").innerHTML = "‚èπ";
        
        // D√©marrer le minuteur
        recordingSeconds = 0;
        recordingTimer = setInterval(() => {
            recordingSeconds++;
            const minutes = Math.floor(recordingSeconds / 60);
            const seconds = recordingSeconds % 60;
            document.getElementById("recordingTimer").textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
        
    } catch (error) {
        console.error("Erreur d'enregistrement:", error);
        alert("Impossible d'acc√©der au microphone. V√©rifiez les permissions.");
    }
}

// Arr√™ter l'enregistrement audio
function stopRecording() {
    if (mediaRecorder && mediaRecorder.state === 'recording') {
        mediaRecorder.stop();
        document.getElementById("recordBtn").classList.remove("recording");
        document.getElementById("recordBtn").innerHTML = "üé§";
        
        // Arr√™ter le minuteur
        if (recordingTimer) {
            clearInterval(recordingTimer);
            recordingTimer = null;
        }
    }
}

// G√©rer le clic sur le bouton d'enregistrement
document.addEventListener('click', function(e) {
    if (e.target.id === 'recordBtn') {
        if (mediaRecorder && mediaRecorder.state === 'recording') {
            stopRecording();
        } else {
            startRecording();
        }
    }
});

// Envoyer l'audio (simulation)
function sendAudio() {
    document.getElementById("message").textContent = "‚úÖ Audio envoy√© pour √©valuation !";
    document.getElementById("message").className = "message success";
    
    // Simulation d'√©valuation apr√®s 2 secondes
    setTimeout(() => {
        document.getElementById("message").textContent = "üéØ Bonne prononciation ! Continue comme √ßa !";
        document.getElementById("message").className = "message success";
    }, 2000);
}

// Afficher le formulaire de contact
function showContactForm() {
    document.getElementById("lessonSection").style.display = "none";
    document.getElementById("exerciseSection").style.display = "none";
    document.getElementById("oralPracticeSection").style.display = "none";
    document.getElementById("contactForm").style.display = "block";
}

// Cacher le formulaire de contact
function hideContactForm() {
    document.getElementById("contactForm").style.display = "none";
    document.getElementById("lessonSection").style.display = "block";
}

// Envoyer le formulaire de contact
function sendContactForm() {
    const email = document.getElementById("email").value;
    const subject = document.getElementById("subject").value;
    const messageText = document.getElementById("messageText").value;
    
    if (!email || !subject || !messageText) {
        alert("Veuillez remplir tous les champs du formulaire.");
        return;
    }
    
    // Simuler l'envoi d'email (dans un cas r√©el, utiliser un service d'email)
    const mailtoLink = `mailto:urminmanantena@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(`De: ${email}\n\n${messageText}`)}`;
    window.location.href = mailtoLink;
    
    document.getElementById("message").textContent = "Formulaire envoy√© ! Redirection vers l'email...";
    document.getElementById("message").className = "message success";
    
    // R√©initialiser le formulaire
    document.getElementById("email").value = "";
    document.getElementById("subject").value = "";
    document.getElementById("messageText").value = "";
    
    // Retour √† la le√ßon apr√®s 3 secondes
    setTimeout(() => {
        hideContactForm();
    }, 3000);
}

// R√©initialiser tout le parcours
function resetAll() {
    if(confirm("Voulez-vous vraiment r√©initialiser tout le parcours ? Votre progression et votre score seront perdus.")) {
        currentLessonIndex = 0;
        currentExerciseIndex = 0;
        score = 0;
        localStorage.setItem("currentLessonIndex", currentLessonIndex);
        localStorage.setItem("currentExerciseIndex", currentExerciseIndex);
        localStorage.setItem("score", score);
        showLesson();
    }
}

// V√©rifier le statut de connexion au chargement
window.addEventListener('load', checkOnlineStatus);
window.addEventListener('online', checkOnlineStatus);
window.addEventListener('offline', checkOnlineStatus);

// D√©marrage
showLesson();
</script>

</body>
</html>
